import{o as E,p as P,r as f,j as e,c as v,B as m,q as _,s as k,t as D,h as T,b as B,d as O,R as N}from"./index-UD_dH3ZA.js";import{T as M}from"./index-BT_dn5N8.js";import{u as R,B as q}from"./index-DMnKym-8.js";import{C as F}from"./index-CVrtAT_R.js";import{R as L}from"./index-Bx0SBfAf.js";import{I as z}from"./index-CtP9EIvt.js";import{L as U}from"./index-YMfG-I4N.js";import{C as j,c as I,a as G}from"./select-options-Co2lB9CI.js";import{S as H}from"./select-options-tV_qHAb1.js";import{a as Q}from"./validation-schemas-BV6dQSB1.js";import{u as V}from"./formik.esm-BfZ3xfzO.js";import{w as Y}from"./with-auth-CLELORJ7.js";const $=({setPicturesState:t})=>{const{t:d}=R(),[b]=E(),[p]=P(),[s,n]=f.useState([]),i=f.useRef(null),g=async a=>{const r=Array.from(a);if(r.some(({type:l})=>l!=="image/png"&&l!=="image/jpeg")){m.warn(d("file_has_to_be_png_or_jpg"),{className:"!bg-warn"});return}if(r.length+s.length>5){m.warn(d("You can upload up to 5 files."),{className:"!bg-warn"});return}const c=await Promise.all(r.map(async l=>{const u=await b(l);return{file:l,preview:URL.createObjectURL(l),id:u.data}}));n(l=>[...l,...c])},w=a=>{const r=a.currentTarget.files;r&&g(r)},h=a=>{a.preventDefault();const r=a.dataTransfer.files;r&&g(r)},x=async a=>{(await p(s[a].id)).error?m.error(d("Something went wrong, try again later."),{className:"!bg-error"}):(n(c=>c.filter((l,u)=>u!==a)),i.current&&(i.current.value=""))};return f.useEffect(()=>{t(s.map(({id:a})=>a))},[s]),f.useEffect(()=>()=>{s.length>0&&s.forEach(({id:a})=>p(a))},[]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-7",children:[e.jsx("h2",{className:"text-green600 font-semibold text-3xl",children:d("Add photos")}),e.jsxs("span",{className:"text-2xl text-white200",children:[s?s==null?void 0:s.length:0,"/5"]})]}),e.jsx("label",{htmlFor:"pictures",className:"w-full flex-1 grid grid-cols-2 auto-rows-[150px] mobile:auto-rows-[225px] gap-6",onDrop:a=>h(a),onDragOver:a=>a.preventDefault(),children:Array(5).fill(!1).map((a,r)=>e.jsx("div",{className:v("h-full mobile:col-span-2 relative group",r===0?"col-span-2 row-span-2 mobile:row-span-1":""),children:s[r]?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:s[r].preview,alt:`Preview ${r}`,className:"rounded-lg object-cover w-full h-full",onClick:c=>c.preventDefault(),onError:()=>{m.error(d("Failed to load image."),{className:"!bg-error"}),x(r)}}),e.jsx("div",{onClick:c=>c.preventDefault(),className:"rounded-lg absolute inset-0 transition-all bg-[black]/40 invisible group-hover:visible opacity-0 group-hover:opacity-100 flex justify-center items-center",children:e.jsx(_,{onClick:()=>x(r),className:v("stroke-white100 mobile:size-12 cursor-pointer hover:scale-110 transition-all hover:stroke-soft-red",r===0?"size-14":"size-10")})})]}):e.jsx("div",{className:v("border-2 bg-green50 rounded-lg w-full h-full flex justify-center items-center cursor-pointer",r===0?"text-3xl mobile:text-2xl":"text-2xl",r===s.length?"border-dashed border-green600":"border-green400"),children:s.length===r?e.jsx("span",{className:"underline text-green600",children:d("Add photo")}):e.jsx(k,{})},r)},r))}),e.jsx("input",{ref:i,id:"pictures",name:"pictures",type:"file",multiple:!0,onChange:w,accept:"image/png, image/jpeg",className:"hidden"})]})},J={name:"",category:null,color:null,state:null,wantedCategory:null,description:"",pictureIds:[]},W=()=>{const{t}=R(),[d]=D(),b=T(),{data:p}=B(),{data:s}=O(),{errors:n,touched:i,handleBlur:g,values:w,handleChange:h,handleSubmit:x,setFieldValue:a}=V({initialValues:J,onSubmit:async()=>{try{const o=await d({name:r,description:C,color:l.value,category:c.value,state:parseInt(u.value),wantedCategory:y?y.map(({value:A})=>A):[],pictureIds:S});console.log(o),o.error?m.error(t("Something went wrong, try again later."),{className:"!bg-error"}):(m.success(t("Item added successfully."),{className:"!bg-green100"}),b(N.MY_ITEMS))}catch(o){m.error(JSON.stringify(o),{className:"!bg-error"})}},validationSchema:Q}),{name:r,category:c,color:l,state:u,wantedCategory:y,description:C,pictureIds:S}=w;return e.jsxs(U,{children:[e.jsx(L,{to:N.HOME,children:t("return to Home page")}),e.jsx("h1",{className:"text-4xl font-semibold my-5",children:t("Add Item")}),e.jsxs("form",{className:"space-y-5",onSubmit:x,children:[e.jsxs("div",{className:"flex below-998:flex-col gap-6",children:[e.jsxs(F,{className:"w-full space-y-6 p-8",children:[e.jsx(z,{label:e.jsxs(e.Fragment,{children:[t("item_name")," ",e.jsxs("span",{className:"text-green600 text-[14px]",children:["(",t("Required"),")"]})]}),placeholder:t("Enter the name of your item"),additionalBlock:t("Enter at least 10 characters"),charCounter:{withCharCounter:!0,maxChars:40},name:"name",type:"text",onChange:h,onBlur:g,value:r,error:i.name?n.name:void 0}),e.jsx(j,{label:e.jsxs(e.Fragment,{children:[t("Category")," ",e.jsxs("span",{className:"text-green600 text-[14px]",children:["(",t("Required"),")"]})]}),options:I(p,t),onChange:o=>a("category",o),value:c,error:i.category?n.category:void 0}),e.jsx(j,{label:e.jsxs(e.Fragment,{children:[t("Color")," ",e.jsxs("span",{className:"text-green600 text-[14px]",children:["(",t("Required"),")"]})]}),options:G(s,t),onChange:o=>a("color",o),value:l,error:i.color?n.color:void 0}),e.jsx(j,{label:e.jsxs(e.Fragment,{children:[t("Wanted category")," ",e.jsxs("span",{className:"text-green600 text-[14px]",children:["(",t("Optional"),")"]})]}),additionalBlock:t("All categories is chosen by default"),placeholder:t("All"),isMulti:!0,options:I(p,t),onChange:o=>a("wantedCategory",o),value:y,error:i.wantedCategory&&n.wantedCategory?n.wantedCategory[0]:void 0}),e.jsx(j,{label:e.jsxs(e.Fragment,{children:[t("State")," ",e.jsxs("span",{className:"text-green600 text-[14px]",children:["(",t("Required"),")"]})]}),options:H,onChange:o=>a("state",o),value:u,error:i.state?n.state:void 0}),e.jsx(M,{label:e.jsxs(e.Fragment,{children:[t("Description")," ",e.jsxs("span",{className:"text-green600 text-[14px]",children:["(",t("Required"),")"]})]}),placeholder:t("Describe your item"),additionalBlock:t("Enter at least 40 characters"),charCounter:{withCharCounter:!0,maxChars:500},name:"description",onChange:h,onBlur:g,value:C,error:i.description?n.description:void 0})]}),e.jsx(F,{className:"w-full py-8 px-20 tablet:px-12 mobile:!px-8 flex flex-col",children:e.jsx($,{setPicturesState:o=>a("pictureIds",o)})})]}),e.jsx(q,{className:"above-999:max-w-[300px] w-full",type:"submit",children:t("Post Item")})]})]})},ce=Y(W);export{ce as default};
