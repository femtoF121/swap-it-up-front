import{r as p,j as e,c as j,U as F,g as U,R as I,A,V as O,B as m,W as Y,X as B,Y as H,Z as T,_ as G,L as b,E as P,$ as Q}from"./index-ChiGoYOE.js";import{C as f}from"./index-CfwXKslJ.js";import{R as W}from"./index-DgM7oJdA.js";import{L as $}from"./index-BPZLh6Dr.js";import{U as v}from"./index-CWhhQjpa.js";import{u as N,B as h}from"./index-CdsAk-en.js";import{i as V}from"./placeholder-image-CBe2Di1M.js";import{w as X,U as Z}from"./with-auth-CFJ3HFdf.js";const _=({setStars:r,stars:l,className:o})=>{const[i,n]=p.useState(-1),c=a=>{const t=[];for(let s=0;s<5;s++)t.push(a>=s);r(t)},x=(a,t)=>i===-1?a?"currentcolor":"transparent":t<=i?"currentcolor":"transparent";return e.jsxs("div",{className:j("flex items-center text-2xl",o),children:[l.map((a,t)=>e.jsx(F,{style:{fill:x(a,t),cursor:"pointer"},onMouseLeave:()=>n(-1),onMouseEnter:()=>n(t),onClick:()=>c(t)},t)),e.jsx("span",{className:"font-semibold ml-2",children:l.filter(a=>a).length})]})},D=({item:r,myItem:l=!1})=>{const[o,i]=p.useState(!1),{t:n}=N(),c=U();return e.jsxs(f,{className:j("!p-3 flex gap-2 font-[400] hover:brightness-95 cursor-pointer"),onClick:()=>c(I.ITEM.replace(":id",r.id)),children:[e.jsxs("div",{className:"relative aspect-[16/12] w-full max-w-[100px] mobile:max-w-[75px] rounded-lg overflow-hidden shrink-0hover:brightness-95 cursor-pointer",children:[!o&&e.jsx("div",{className:"skeleton-loader !rounded-none"}),e.jsx("img",{src:r.pictureIds[0]?"https://apim-swapitup.azure-api.net/api/items/pictures/"+r.pictureIds[0]:V,alt:"wanted item photo",className:j("w-full h-full object-cover",{hidden:!o}),onLoad:()=>i(!0)})]}),e.jsxs("div",{className:"text-[12px]",children:[e.jsx("h4",{className:"line-clamp-1 break-all text-[16px] mb-2",children:n(r.name)}),l?e.jsxs("p",{className:"capitalize",children:[e.jsxs("span",{className:"text-green600",children:[n("Category"),": "]}),r.category]}):e.jsxs("p",{children:[e.jsxs("span",{className:"text-green600",children:[n("Wants to exchange on"),":"]}),e.jsx("br",{}),e.jsx("span",{className:"line-clamp-1 capitalize",children:r.wantedCategory})]})]})]})},J=({onClose:r,isOpen:l,className:o,ratedItemID:i,...n})=>{const{t:c}=N(),x=A(r),[a]=O(),[t,s]=p.useState([!1,!1,!1,!1,!1]),d=async()=>{if((await a({id:i,rate:t.filter(u=>u).length})).error){m.error(c("Something went wrong, try again later."),{className:"!bg-error"});return}m.success(c("User rated successfully"),{className:"!bg-green100"}),r()};if(p.useEffect(()=>(l?document.body.style.overflow="hidden":document.body.style.overflow="auto",()=>{document.body.style.overflow="auto"}),[l]),l)return e.jsx("div",{className:"fixed z-20 inset-0 top-0 bg-white400/40 !w-full flex justify-center items-center",children:e.jsx("div",{className:" w-full max-w-[500px] mx-10 my-4",ref:x,...n,children:e.jsxs(f,{className:"!font-semibold w-full flex flex-col items-center gap-6",children:[e.jsx(_,{className:"[&>*]:size-16 !text-6xl",stars:t,setStars:s}),e.jsx(h,{size:"sm",disabled:t.filter(g=>g).length<=0,onClick:d,children:c("Rate user")})]})})})},C=({offered:r,requested:l,myDeal:o,incoming:i=!1,status:n,id:c,refetch:x})=>{const[a,t]=p.useState(!1),{t:s}=N(),{data:d,isLoading:g,refetch:u}=Y(o?l.userId:r.userId),[S]=B(),[k]=H(),[R]=T(),[M]=G();console.log();const y=async()=>{if((await S(c)).error){m.error(s("Something went wrong, try again later."),{className:"!bg-error"});return}m.success(s("Deal deleted"),{className:"!bg-green100"}),u(),x()},z=async()=>{if((await k(c)).error){m.error(s("Something went wrong, try again later."),{className:"!bg-error"});return}m.success(s("Deal accepted"),{className:"!bg-green100"}),u(),x()},L=async()=>{if((await R(c)).error){m.error(s("Something went wrong, try again later."),{className:"!bg-error"});return}m.success(s("Deal canceled"),{className:"!bg-green100"}),x(),u()},E=async()=>{if((await M(c)).error){m.error(s("Something went wrong, try again later."),{className:"!bg-error"});return}m.success(s("Deal finished"),{className:"!bg-green100"}),x(),u(),t(!0)};return p.useEffect(()=>{x(),u()},[r.rate,l.rate]),e.jsxs(f,{className:"!font-semibold w-full",children:[g?e.jsx(b,{}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:j("flex gap-4 w-full",d?"justify-between":"justify-end"),children:[d&&e.jsxs("h2",{className:"text-[24px] below-768:text-[24px] mb-[24px] below-768:mb-[4px] leading-none",children:[s("Deal")," ",s("with")," ",e.jsx(v,{user:d})]}),e.jsxs("div",{children:[s("Status"),": ",n===0?e.jsx("span",{className:"text-orange400",children:s("Requested")}):n===1?e.jsx("span",{className:"text-green600",children:s("Started")}):n===2?e.jsx("span",{className:"text-soft-red",children:s("Canceled")}):n===4?e.jsx("span",{className:"text-teal400",children:s("Finished")}):"..."]})]}),e.jsxs("div",{className:"w-full shrink-[1.1]",children:[e.jsxs("h3",{className:"mb-[16px] below-768:mb-[12px] text-[16px]",children:[s("Item of user")," ",e.jsx(v,{user:d,withRating:!1}),":"]}),e.jsx(D,{item:o?l:r}),e.jsxs("div",{className:"relative mb-[24px] mt-[32px] below-768:mb-[16px]  below-768:mt-[20px]",children:[e.jsx(P,{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-white100 px-2 box-content"}),e.jsx("hr",{className:"h-px border-none w-full bg-green400"})]}),e.jsxs("h3",{className:"mb-[16px] below-768:mb-[12px] text-[16px]",children:[s("Your item"),":"]}),e.jsx(D,{myItem:!0,item:o?r:l})]}),e.jsxs("div",{className:"flex items-center justify-end gap-[16px] mt-[16px]",children:[i&&n===0&&e.jsxs(e.Fragment,{children:[e.jsx(h,{variant:"secondary",size:"sm",className:"!text-[16px] !px-[24px] !h-[40px]",onClick:y,children:s("Decline")}),e.jsx(h,{size:"sm",className:"!text-[16px] !px-[24px] !h-[40px]",onClick:z,children:s("Accept")})]}),n===1&&e.jsxs(e.Fragment,{children:[e.jsx(h,{variant:"secondary",size:"sm",className:"!text-[16px] !px-[24px] !h-[40px]",onClick:L,children:s("Cancel")}),e.jsx(h,{size:"sm",className:"!text-[16px] !px-[24px] !h-[40px]",onClick:E,children:s("Finish")})]}),(n===0&&!i||n===2||n===4)&&e.jsx(h,{variant:"secondary",size:"sm",className:"!text-[16px] !px-[24px] !h-[40px]",onClick:y,children:s("Delete")}),n===4&&(o?l.rate===0:r.rate===0)&&e.jsx(h,{variant:"secondary",size:"sm",onClick:()=>t(!0),className:"!text-[16px] !px-[24px] !h-[40px]",children:s("Rate user")})]})]}),e.jsx(J,{ratedItemID:o?l.id:r.id,isOpen:a,onClose:()=>t(!1)})]})},K=()=>{const{t:r}=N(),l=p.useContext(Z),{data:o,isLoading:i,refetch:n}=Q(),[c,x]=p.useState([]);return p.useEffect(()=>{o&&x(o.list.filter(({requestedItem:a,offeredItem:t})=>a.userId===l.id||t.userId===l.id))},[o,x]),e.jsxs($,{children:[e.jsx(W,{to:I.HOME,children:r("return to Home page")}),e.jsxs(f,{className:"mt-8",children:[e.jsx("h2",{className:"text-3xl font-semibold mb-6",children:r("Outcoming deals")}),i?e.jsx(b,{className:"mx-auto mt-4"}):c.filter(({requestedItem:a})=>a.userId!==l.id).length>0?e.jsx("div",{className:"[&>*]:w-1/2 below-768:[&>*]:w-full gap-4 flex flex-wrap",children:c.filter(({requestedItem:a})=>a.userId!==l.id).map(({status:a,offeredItem:t,requestedItem:s,id:d})=>e.jsx(C,{id:d,myDeal:t.userId===l.id,offered:t,requested:s,status:a,refetch:n},d))}):e.jsx("span",{className:"text-xl font-semibold",children:r("You don't have any outcoming deals yet")})]}),e.jsxs(f,{className:"mt-8",children:[e.jsx("h2",{className:"text-3xl font-semibold mb-6",children:r("Incoming deals")}),i?e.jsx(b,{className:"mx-auto mt-4"}):c.filter(({requestedItem:a})=>a.userId===l.id).length>0?e.jsx("div",{className:"[&>*]:w-1/2 below-768:[&>*]:w-full gap-4 flex flex-wrap",children:c.filter(({requestedItem:a})=>a.userId===l.id).map(({status:a,offeredItem:t,requestedItem:s,id:d})=>e.jsx(C,{id:d,incoming:!0,myDeal:t.userId===l.id,offered:t,requested:s,status:a,refetch:n},d))}):e.jsx("span",{className:"text-xl font-semibold",children:r("You don't have any incoming deals yet")})]})]})},ce=X(K);export{ce as default};
