import{J as W,B as o,j as s,r as y,g as X,K as Z,M as ee,N as se,O as ae,P as re,R as _,c as N,d as J,Q as $}from"./index-ChiGoYOE.js";import{u as G,B as t}from"./index-CdsAk-en.js";import{C as I}from"./index-CfwXKslJ.js";import{R as ne}from"./index-DgM7oJdA.js";import{I as d}from"./index-DAAyRcKo.js";import{L as le}from"./index-BPZLh6Dr.js";import{c as te,b as ie}from"./validation-schemas-DapXOd8L.js";import{u as H}from"./formik.esm-oC_Da1zn.js";import{a as Q}from"./avatar-placeholder-C3uXbfoF.js";import{w as oe}from"./with-auth-CFJ3HFdf.js";const ce=()=>{const{t:a}=G(),[b]=W(),{values:A,handleChange:k,handleSubmit:B,handleBlur:C,touched:f,errors:l,resetForm:p}=H({initialValues:{currentPassword:"",newPassword:""},onSubmit:async()=>{try{const c=await b({newPassword:r,oldPassword:e});if(c.error){if("data"in c.error){const i=c.error.data;let u="";for(const S in i.errors)u+=i.errors[S].map(z=>z).join(`
`);o.error(a(u)||a("Something went wrong, try again later."),{className:"!bg-error"})}}else o.success(a("Password changed successfully"),{className:"!bg-green100"}),p()}catch(c){o.error(JSON.stringify(c),{className:"!bg-error"})}},validationSchema:te}),{currentPassword:e,newPassword:r}=A;return s.jsx(I,{className:"w-full",children:s.jsxs("form",{onSubmit:B,children:[s.jsxs("div",{className:"flex flex-wrap gap-6 items-center",children:[s.jsx("h2",{className:"text-2xl",children:a("Change password")}),s.jsx(t,{size:"sm",className:"px-10",type:"submit",disabled:!!l.currentPassword||!!l.newPassword,children:a("Save")})]}),s.jsx("hr",{className:"h-px border-0 bg-white200 w-full my-6"}),s.jsxs("div",{className:"grid grid-cols-[repeat(auto-fit,minmax(200px,1fr))] gap-x-8 gap-y-4",children:[s.jsx(d,{label:a("Current password"),name:"currentPassword",type:"password",value:e,onChange:k,onBlur:C,error:f.currentPassword?l.currentPassword:void 0}),s.jsx(d,{label:a("New password"),name:"newPassword",type:"password",value:r,onChange:k,onBlur:C,error:f.newPassword?l.newPassword:void 0}),s.jsx("div",{className:"invisible"})]})]})})},me=()=>{var E,M;const{t:a}=G(),[b,A]=y.useState(!1),[k,B]=y.useState(!1),C=X(),[f,l]=y.useState(!1),p=y.useRef(null),{data:e,isLoading:r,refetch:c}=Z(),i=ee(),[u,S]=se(),[z]=ae(),[V]=re(),{values:Y,handleBlur:g,handleChange:w,handleSubmit:q,touched:F,errors:x,setFieldValue:m}=H({initialValues:{name:a("Loading")+"...",surname:a("Loading")+"...",nickname:a("Loading")+"...",country:a("Loading")+"...",city:a("Loading")+"...",avatar:null},onSubmit:async()=>{let n;if(h)n=h;else{const K=await u(e.id);let R,j;R=await fetch(K.isSuccess?`https://apim-swapitup.azure-api.net/api/user/details/${e.id}/avatar`:Q),j=h||await(R==null?void 0:R.blob()),n=new File([j],"avatar.jpg",{type:j==null?void 0:j.type})}(await z({name:D,surname:O,nickname:v,country:P,city:L,avatar:n})).error?o.error(a("Something went wrong, try again later."),{className:"!bg-error"}):o.success(a("Information changed successfully"),{className:"!bg-green100"}),c()},validationSchema:ie}),{name:D,surname:O,nickname:v,country:P,city:L,avatar:h}=Y,U=async()=>{(await V()).error?o.error(a("Something went wrong, try again later."),{className:"!bg-error"}):o.success(a("Account deleted successfully"),{className:"!bg-green100"}),C(_.HOME)};return y.useEffect(()=>{!r&&e&&(m("name",e.name||""),m("surname",e.surname||""),m("nickname",e.nickname||""),m("country",e.address.country||""),m("city",e.address.city||""),(async()=>{try{await u(e.id)}catch(T){console.error("Failed to fetch avatar:",T)}})())},[e,r,m,u]),s.jsxs(le,{children:[s.jsx(ne,{to:_.HOME,children:"return to Home page"}),s.jsx("h1",{className:"text-4xl font-semibold my-5",children:a("Settings")}),s.jsxs("div",{className:"flex gap-6 below-768:flex-col items-start",children:[s.jsxs("div",{className:"above-769:max-w-[520px] w-full flex flex-col gap-6 items-center",children:[s.jsxs(I,{className:"w-full !p-8 flex flex-col items-center",children:[s.jsx("div",{className:"relative rounded-full overflow-hidden size-[250px]",children:r||S.isLoading?s.jsx("div",{className:"skeleton-loader"}):s.jsxs(s.Fragment,{children:[!b&&s.jsx("div",{className:"skeleton-loader"}),s.jsx("img",{src:h?URL.createObjectURL(h):S.isSuccess?`https://apim-swapitup.azure-api.net/api/user/details/${e.id}/avatar`:Q,alt:"avatar",className:N("rounded-full aspect-square h-[250px] object-cover",{hidden:!b}),onLoad:()=>A(!0),height:250,width:250})]})}),s.jsx("div",{className:N("relative mt-6",{"min-h-6 max-w-[250px] w-full":r,hidden:!(e!=null&&e.name||e!=null&&e.surname)&&!r}),children:r?s.jsx("div",{className:"skeleton-loader"}):s.jsxs("span",{className:"font-semibold text-2xl",children:[e==null?void 0:e.name," ",e==null?void 0:e.surname]})}),s.jsx("div",{className:N("relative mt-1",{"min-h-4 max-w-[150px] w-full":r,hidden:!(e!=null&&e.nickname)&&!r}),children:r?s.jsx("div",{className:"skeleton-loader"}):v&&s.jsx("span",{children:e==null?void 0:e.nickname})}),s.jsx("div",{className:N("relative mt-1",{"min-h-4 max-w-[300px] w-full":r,hidden:!(e!=null&&e.address.country||e!=null&&e.address.city)&&!r}),children:r?s.jsx("div",{className:"skeleton-loader"}):(!!(e!=null&&e.address.country)||!!(e!=null&&e.address.city))&&s.jsxs("span",{className:"text-white200",children:[e==null?void 0:e.address.country,(e==null?void 0:e.address.country)&&(e==null?void 0:e.address.city)&&", ",e==null?void 0:e.address.city]})}),s.jsx("div",{className:N("relative mt-2",{"min-h-4 max-w-[200px] w-full":i.isLoading,hidden:!((E=i.data)!=null&&E.email)&&!i.isLoading}),children:i.isLoading?s.jsx("div",{className:"skeleton-loader"}):s.jsx("span",{children:(M=i.data)==null?void 0:M.email})})]}),s.jsx("div",{className:"below-768:hidden max-w-[300px]  w-full",children:f?s.jsxs("div",{className:"flex w-full gap-6",children:[s.jsxs(t,{onClick:()=>l(!1),variant:"secondary",className:"w-full !text-base flex items-center",children:[s.jsx(J,{className:"rotate-45 size-6 mr-4 translate-y-[2px]"}),a("No")]}),s.jsxs(t,{onClick:U,variant:"secondary",className:"w-full !text-base !text-teal600 flex items-center !shadow-teal600",children:[s.jsx($,{className:"mr-4 size-5 translate-y-[1px]"}),a("Yes")]})]}):s.jsx(t,{onClick:()=>l(!0),variant:"secondary",className:"!shadow-teal600 !text-teal600 !bg-transparent !text-base w-full",children:a("Delete account")})})]}),s.jsxs("div",{className:"flex flex-col gap-6 w-full",children:[s.jsx(I,{className:"w-full",children:s.jsxs("form",{onSubmit:q,children:[s.jsxs("div",{className:"flex flex-wrap gap-6 items-center",children:[s.jsx("h2",{className:"text-2xl",children:a("Change personal info")}),s.jsx(t,{size:"sm",type:"submit",disabled:!e||(e==null?void 0:e.name)===D&&(e==null?void 0:e.surname)===O&&((e==null?void 0:e.nickname)===null&&v===""||(e==null?void 0:e.nickname)===v)&&((e==null?void 0:e.address.country)===null&&P===""||(e==null?void 0:e.address.country)===P)&&((e==null?void 0:e.address.city)===null&&L===""||(e==null?void 0:e.address.city)===L)&&(h===null||!k)||!!x.name||!!x.surname||!!x.nickname,children:a("Save")})]}),s.jsx("hr",{className:"h-px border-0 bg-white200 w-full my-6"}),s.jsxs("div",{className:"grid grid-cols-[repeat(auto-fit,minmax(200px,1fr))] gap-x-8 gap-y-4",children:[s.jsx(d,{label:a("Name"),name:"name",value:D,onChange:w,onBlur:g,error:F.name?JSON.stringify(x.name):void 0}),s.jsx(d,{label:a("Surname"),name:"surname",value:O,onChange:w,onBlur:g,error:F.surname?JSON.stringify(x.surname):void 0}),s.jsx(d,{label:a("Nickname"),name:"nickname",value:v,onChange:w,onBlur:g,error:F.nickname?JSON.stringify(x.nickname):void 0}),s.jsx(d,{label:a("Country"),name:"country",value:P,onChange:w,onBlur:g}),s.jsx(d,{label:a("City"),name:"city",value:L,onChange:w,onBlur:g}),s.jsxs("label",{htmlFor:"avatar",className:"self-end mt-6",children:[s.jsx("input",{ref:p,id:"avatar",name:"avatar",type:"file",className:"hidden",onChange:n=>{if(n.currentTarget.files){if(n.currentTarget.files[0].type!=="image/png"&&n.currentTarget.files[0].type!=="image/jpeg"){o.warn(a("file_has_to_be_png_or_jpg"),{className:"!bg-warn"});return}B(!0),m("avatar",n.currentTarget.files[0])}},accept:"image/png, image/jpeg"}),s.jsx(t,{variant:"secondary",size:"sm",className:"w-full h-[40px] !text-[16px]",onClick:()=>{p.current&&p.current.click()},children:a("Upload avatar")})]})]})]})}),s.jsx(ce,{}),s.jsx("div",{className:"above-769:hidden w-full",children:f?s.jsxs("div",{className:"flex w-full gap-4",children:[s.jsxs(t,{onClick:()=>l(!1),variant:"secondary",className:"w-full !text-base flex items-center justify-center",children:[s.jsx(J,{className:"rotate-45 size-6 mr-4 translate-y-[2px]"}),a("No")]}),s.jsxs(t,{onClick:U,variant:"secondary",className:"w-full !text-base !text-teal600 flex items-center !shadow-teal600 justify-center",children:[s.jsx($,{className:"mr-4 size-5 translate-y-[1px]"}),a("Yes")]})]}):s.jsx(t,{onClick:()=>l(!0),variant:"secondary",className:"!shadow-teal600 !text-teal600 !bg-transparent !text-base w-full",children:a("Delete account")})})]})]})]})},ye=oe(me);export{ye as default};
