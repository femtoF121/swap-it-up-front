import{n as E,o as P,r as f,j as e,c as v,B as m,p as _,q as k,s as D,g as T,a as B,b as O,R as N}from"./index-ChiGoYOE.js";import{T as M}from"./index-CuBQWL7H.js";import{u as R,B as q}from"./index-CdsAk-en.js";import{C as F}from"./index-CfwXKslJ.js";import{R as L}from"./index-DgM7oJdA.js";import{I as z}from"./index-DAAyRcKo.js";import{L as U}from"./index-BPZLh6Dr.js";import{C as j,c as I,a as G}from"./select-options-POy7bmkj.js";import{S as H}from"./select-options-raVrnKNp.js";import{a as Q}from"./validation-schemas-DapXOd8L.js";import{u as V}from"./formik.esm-oC_Da1zn.js";import{w as Y}from"./with-auth-CFJ3HFdf.js";const $=({setPicturesState:r})=>{const{t:d}=R(),[b]=E(),[p]=P(),[s,n]=f.useState([]),i=f.useRef(null),g=async a=>{const t=Array.from(a);if(t.some(({type:l})=>l!=="image/png"&&l!=="image/jpeg")){m.warn(d("file_has_to_be_png_or_jpg"),{className:"!bg-warn"});return}if(t.length+s.length>5){m.warn(d("You can upload up to 5 files."),{className:"!bg-warn"});return}const c=await Promise.all(t.map(async l=>{const u=await b(l);return{file:l,preview:URL.createObjectURL(l),id:u.data}}));n(l=>[...l,...c])},w=a=>{const t=a.currentTarget.files;t&&g(t)},h=a=>{a.preventDefault();const t=a.dataTransfer.files;t&&g(t)},x=async a=>{(await p(s[a].id)).error?m.error(d("Something went wrong, try again later."),{className:"!bg-error"}):(n(c=>c.filter((l,u)=>u!==a)),i.current&&(i.current.value=""))};return f.useEffect(()=>{r(s.map(({id:a})=>a))},[s]),f.useEffect(()=>()=>{s.length>0&&s.forEach(({id:a})=>p(a))},[]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-7",children:[e.jsx("h2",{className:"text-green600 font-semibold text-3xl",children:d("Add photos")}),e.jsxs("span",{className:"text-2xl text-white200",children:[s?s==null?void 0:s.length:0,"/5"]})]}),e.jsx("label",{htmlFor:"pictures",className:"w-full flex-1 grid grid-cols-2 auto-rows-[150px] mobile:auto-rows-[225px] gap-6",onDrop:a=>h(a),onDragOver:a=>a.preventDefault(),children:Array(5).fill(!1).map((a,t)=>e.jsx("div",{className:v("h-full mobile:col-span-2 relative group",t===0?"col-span-2 row-span-2 mobile:row-span-1":""),children:s[t]?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:s[t].preview,alt:`Preview ${t}`,className:"rounded-lg object-cover w-full h-full",onClick:c=>c.preventDefault(),onError:()=>{m.error(d("Failed to load image."),{className:"!bg-error"}),x(t)}}),e.jsx("div",{onClick:c=>c.preventDefault(),className:"rounded-lg absolute inset-0 transition-all bg-[black]/40 invisible group-hover:visible opacity-0 group-hover:opacity-100 flex justify-center items-center",children:e.jsx(_,{onClick:()=>x(t),className:v("stroke-white100 mobile:size-12 cursor-pointer hover:scale-110 transition-all hover:stroke-soft-red",t===0?"size-14":"size-10")})})]}):e.jsx("div",{className:v("border-2 bg-green50 rounded-lg w-full h-full flex justify-center items-center cursor-pointer",t===0?"text-3xl mobile:text-2xl":"text-2xl",t===s.length?"border-dashed border-green600":"border-green400"),children:s.length===t?e.jsx("span",{className:"underline text-green600",children:d("Add photo")}):e.jsx(k,{})},t)},t))}),e.jsx("input",{ref:i,id:"pictures",name:"pictures",type:"file",multiple:!0,onChange:w,accept:"image/png, image/jpeg",className:"hidden"})]})},J={name:"",category:null,color:null,state:null,wantedCategory:null,description:"",pictureIds:[]},W=()=>{const{t:r}=R(),[d]=D(),b=T(),{data:p}=B(),{data:s}=O(),{errors:n,touched:i,handleBlur:g,values:w,handleChange:h,handleSubmit:x,setFieldValue:a}=V({initialValues:J,onSubmit:async()=>{try{const o=await d({name:t,description:C,color:l.value,category:c.value,state:parseInt(u.value),wantedCategory:y?y.map(({value:A})=>A):[],pictureIds:S});console.log(o),o.error?m.error(r("Something went wrong, try again later."),{className:"!bg-error"}):(m.success(r("Item added successfully."),{className:"!bg-green100"}),b(N.MY_ITEMS))}catch(o){m.error(JSON.stringify(o),{className:"!bg-error"})}},validationSchema:Q}),{name:t,category:c,color:l,state:u,wantedCategory:y,description:C,pictureIds:S}=w;return e.jsxs(U,{children:[e.jsx(L,{to:N.HOME,children:r("return to Home page")}),e.jsx("h1",{className:"text-4xl font-semibold my-5",children:r("Add Item")}),e.jsxs("form",{className:"space-y-5",onSubmit:x,children:[e.jsxs("div",{className:"flex below-998:flex-col gap-6",children:[e.jsxs(F,{className:"w-full space-y-6 p-8",children:[e.jsx(z,{label:e.jsxs(e.Fragment,{children:[r("item_name")," ",e.jsxs("span",{className:"text-green600 text-[14px]",children:["(",r("Required"),")"]})]}),placeholder:r("Enter the name of your item"),additionalBlock:r("Enter at least 10 characters"),charCounter:{withCharCounter:!0,maxChars:40},name:"name",type:"text",onChange:h,onBlur:g,value:t,error:i.name?n.name:void 0}),e.jsx(j,{label:e.jsxs(e.Fragment,{children:[r("Category")," ",e.jsxs("span",{className:"text-green600 text-[14px]",children:["(",r("Required"),")"]})]}),options:I(p,r),onChange:o=>a("category",o),value:c,error:i.category?n.category:void 0}),e.jsx(j,{label:e.jsxs(e.Fragment,{children:[r("Color")," ",e.jsxs("span",{className:"text-green600 text-[14px]",children:["(",r("Required"),")"]})]}),options:G(s,r),onChange:o=>a("color",o),value:l,error:i.color?n.color:void 0}),e.jsx(j,{label:e.jsxs(e.Fragment,{children:[r("Wanted category")," ",e.jsxs("span",{className:"text-green600 text-[14px]",children:["(",r("Optional"),")"]})]}),additionalBlock:r("All categories is chosen by default"),placeholder:r("All"),isMulti:!0,options:I(p,r),onChange:o=>a("wantedCategory",o),value:y,error:i.wantedCategory&&n.wantedCategory?n.wantedCategory[0]:void 0}),e.jsx(j,{label:e.jsxs(e.Fragment,{children:[r("State")," ",e.jsxs("span",{className:"text-green600 text-[14px]",children:["(",r("Required"),")"]})]}),options:H,onChange:o=>a("state",o),value:u,error:i.state?n.state:void 0}),e.jsx(M,{label:e.jsxs(e.Fragment,{children:[r("Description")," ",e.jsxs("span",{className:"text-green600 text-[14px]",children:["(",r("Required"),")"]})]}),placeholder:r("Describe your item"),additionalBlock:r("Enter at least 40 characters"),charCounter:{withCharCounter:!0,maxChars:500},name:"description",onChange:h,onBlur:g,value:C,error:i.description?n.description:void 0})]}),e.jsx(F,{className:"w-full py-8 px-20 tablet:px-12 mobile:!px-8 flex flex-col",children:e.jsx($,{setPicturesState:o=>a("pictureIds",o)})})]}),e.jsx(q,{className:"above-999:max-w-[300px] w-full",type:"submit",children:r("Post Item")})]})]})},ce=Y(W);export{ce as default};
