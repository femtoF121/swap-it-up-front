import{J as X,B as o,j as s,r as y,g as Z,K as ee,M as se,N as ae,O as re,P as ne,R as V,c as N,d as M,Q as J}from"./index-DGM8O2GK.js";import{u as G,B as t}from"./index-BQR--jp_.js";import{C as O}from"./index-DfStVS8K.js";import{R as le}from"./index-BJ4rP69i.js";import{I as d}from"./index-Wb4QQ_7Q.js";import{L as te}from"./index-C27KeCKp.js";import{c as ie,b as oe}from"./validation-schemas-Cq69umFO.js";import{u as H}from"./formik.esm-BjH5ehjI.js";import{a as $}from"./avatar-placeholder--L0gOkRd.js";import{w as ce}from"./with-auth-wi_QHfPK.js";const me=()=>{const{t:a}=G(),[b]=X(),{values:E,handleChange:S,handleSubmit:_,handleBlur:k,touched:f,errors:l,resetForm:g}=H({initialValues:{currentPassword:"",newPassword:""},onSubmit:async()=>{try{const c=await b({newPassword:r,oldPassword:e});if(c.error){if("data"in c.error){const i=c.error.data;let u="";for(const C in i.errors)u+=i.errors[C].map(A=>A).join(`
`);o.error(a(u)||a("Something went wrong, try again later."),{className:"!bg-error"})}}else o.success(a("Password changed successfully"),{className:"!bg-green100"}),g()}catch(c){o.error(JSON.stringify(c),{className:"!bg-error"})}},validationSchema:ie}),{currentPassword:e,newPassword:r}=E;return s.jsx(O,{className:"w-full",children:s.jsxs("form",{onSubmit:_,children:[s.jsxs("div",{className:"flex flex-wrap gap-6 items-center",children:[s.jsx("h2",{className:"text-2xl",children:a("Change password")}),s.jsx(t,{size:"sm",className:"px-10",type:"submit",disabled:!!l.currentPassword||!!l.newPassword,children:a("Save")})]}),s.jsx("hr",{className:"h-px border-0 bg-white200 w-full my-6"}),s.jsxs("div",{className:"grid grid-cols-[repeat(auto-fit,minmax(200px,1fr))] gap-x-8 gap-y-4",children:[s.jsx(d,{label:a("Current password"),name:"currentPassword",type:"password",value:e,onChange:S,onBlur:k,error:f.currentPassword?l.currentPassword:void 0}),s.jsx(d,{label:a("New password"),name:"newPassword",type:"password",value:r,onChange:S,onBlur:k,error:f.newPassword?l.newPassword:void 0}),s.jsx("div",{className:"invisible"})]})]})})};var Q={BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const de=()=>{var z,I;const{t:a}=G(),[b,E]=y.useState(!1),[S,_]=y.useState(!1),k=Z(),[f,l]=y.useState(!1),g=y.useRef(null),{data:e,isLoading:r,refetch:c}=ee(),i=se(),[u,C]=ae(),[A]=re(),[Y]=ne(),{values:q,handleBlur:p,handleChange:w,handleSubmit:K,touched:B,errors:x,setFieldValue:m}=H({initialValues:{name:a("Loading")+"...",surname:a("Loading")+"...",nickname:a("Loading")+"...",country:a("Loading")+"...",city:a("Loading")+"...",avatar:null},onSubmit:async()=>{let n;if(h)n=h;else{const W=await u(e.id);let L,j;L=await fetch(W.isSuccess?`${Q.VITE_SERVER_URL}/user/details/${e.id}/avatar`:$),j=h||await(L==null?void 0:L.blob()),n=new File([j],"avatar.jpg",{type:j==null?void 0:j.type})}(await A({name:D,surname:F,nickname:v,country:P,city:R,avatar:n})).error?o.error(a("Something went wrong, try again later."),{className:"!bg-error"}):o.success(a("Information changed successfully"),{className:"!bg-green100"}),c()},validationSchema:oe}),{name:D,surname:F,nickname:v,country:P,city:R,avatar:h}=q,U=async()=>{(await Y()).error?o.error(a("Something went wrong, try again later."),{className:"!bg-error"}):o.success(a("Account deleted successfully"),{className:"!bg-green100"}),k(V.HOME)};return y.useEffect(()=>{!r&&e&&(m("name",e.name||""),m("surname",e.surname||""),m("nickname",e.nickname||""),m("country",e.address.country||""),m("city",e.address.city||""),(async()=>{try{await u(e.id)}catch(T){console.error("Failed to fetch avatar:",T)}})())},[e,r,m,u]),s.jsxs(te,{children:[s.jsx(le,{to:V.HOME,children:"return to Home page"}),s.jsx("h1",{className:"text-4xl font-semibold my-5",children:a("Settings")}),s.jsxs("div",{className:"flex gap-6 below-768:flex-col items-start",children:[s.jsxs("div",{className:"above-769:max-w-[520px] w-full flex flex-col gap-6 items-center",children:[s.jsxs(O,{className:"w-full !p-8 flex flex-col items-center",children:[s.jsx("div",{className:"relative rounded-full overflow-hidden size-[250px]",children:r||C.isLoading?s.jsx("div",{className:"skeleton-loader"}):s.jsxs(s.Fragment,{children:[!b&&s.jsx("div",{className:"skeleton-loader"}),s.jsx("img",{src:h?URL.createObjectURL(h):C.isSuccess?`${Q.VITE_SERVER_URL}/user/details/${e.id}/avatar`:$,alt:"avatar",className:N("rounded-full aspect-square h-[250px] object-cover",{hidden:!b}),onLoad:()=>E(!0),height:250,width:250})]})}),s.jsx("div",{className:N("relative mt-6",{"min-h-6 max-w-[250px] w-full":r,hidden:!(e!=null&&e.name||e!=null&&e.surname)&&!r}),children:r?s.jsx("div",{className:"skeleton-loader"}):s.jsxs("span",{className:"font-semibold text-2xl",children:[e==null?void 0:e.name," ",e==null?void 0:e.surname]})}),s.jsx("div",{className:N("relative mt-1",{"min-h-4 max-w-[150px] w-full":r,hidden:!(e!=null&&e.nickname)&&!r}),children:r?s.jsx("div",{className:"skeleton-loader"}):v&&s.jsx("span",{children:e==null?void 0:e.nickname})}),s.jsx("div",{className:N("relative mt-1",{"min-h-4 max-w-[300px] w-full":r,hidden:!(e!=null&&e.address.country||e!=null&&e.address.city)&&!r}),children:r?s.jsx("div",{className:"skeleton-loader"}):(!!(e!=null&&e.address.country)||!!(e!=null&&e.address.city))&&s.jsxs("span",{className:"text-white200",children:[e==null?void 0:e.address.country,(e==null?void 0:e.address.country)&&(e==null?void 0:e.address.city)&&", ",e==null?void 0:e.address.city]})}),s.jsx("div",{className:N("relative mt-2",{"min-h-4 max-w-[200px] w-full":i.isLoading,hidden:!((z=i.data)!=null&&z.email)&&!i.isLoading}),children:i.isLoading?s.jsx("div",{className:"skeleton-loader"}):s.jsx("span",{children:(I=i.data)==null?void 0:I.email})})]}),s.jsx("div",{className:"below-768:hidden max-w-[300px]  w-full",children:f?s.jsxs("div",{className:"flex w-full gap-6",children:[s.jsxs(t,{onClick:()=>l(!1),variant:"secondary",className:"w-full !text-base flex items-center",children:[s.jsx(M,{className:"rotate-45 size-6 mr-4 translate-y-[2px]"}),a("No")]}),s.jsxs(t,{onClick:U,variant:"secondary",className:"w-full !text-base !text-teal600 flex items-center !shadow-teal600",children:[s.jsx(J,{className:"mr-4 size-5 translate-y-[1px]"}),a("Yes")]})]}):s.jsx(t,{onClick:()=>l(!0),variant:"secondary",className:"!shadow-teal600 !text-teal600 !bg-transparent !text-base w-full",children:a("Delete account")})})]}),s.jsxs("div",{className:"flex flex-col gap-6 w-full",children:[s.jsx(O,{className:"w-full",children:s.jsxs("form",{onSubmit:K,children:[s.jsxs("div",{className:"flex flex-wrap gap-6 items-center",children:[s.jsx("h2",{className:"text-2xl",children:a("Change personal info")}),s.jsx(t,{size:"sm",type:"submit",disabled:!e||(e==null?void 0:e.name)===D&&(e==null?void 0:e.surname)===F&&((e==null?void 0:e.nickname)===null&&v===""||(e==null?void 0:e.nickname)===v)&&((e==null?void 0:e.address.country)===null&&P===""||(e==null?void 0:e.address.country)===P)&&((e==null?void 0:e.address.city)===null&&R===""||(e==null?void 0:e.address.city)===R)&&(h===null||!S)||!!x.name||!!x.surname||!!x.nickname,children:a("Save")})]}),s.jsx("hr",{className:"h-px border-0 bg-white200 w-full my-6"}),s.jsxs("div",{className:"grid grid-cols-[repeat(auto-fit,minmax(200px,1fr))] gap-x-8 gap-y-4",children:[s.jsx(d,{label:a("Name"),name:"name",value:D,onChange:w,onBlur:p,error:B.name?JSON.stringify(x.name):void 0}),s.jsx(d,{label:a("Surname"),name:"surname",value:F,onChange:w,onBlur:p,error:B.surname?JSON.stringify(x.surname):void 0}),s.jsx(d,{label:a("Nickname"),name:"nickname",value:v,onChange:w,onBlur:p,error:B.nickname?JSON.stringify(x.nickname):void 0}),s.jsx(d,{label:a("Country"),name:"country",value:P,onChange:w,onBlur:p}),s.jsx(d,{label:a("City"),name:"city",value:R,onChange:w,onBlur:p}),s.jsxs("label",{htmlFor:"avatar",className:"self-end mt-6",children:[s.jsx("input",{ref:g,id:"avatar",name:"avatar",type:"file",className:"hidden",onChange:n=>{if(n.currentTarget.files){if(n.currentTarget.files[0].type!=="image/png"&&n.currentTarget.files[0].type!=="image/jpeg"){o.warn(a("file_has_to_be_png_or_jpg"),{className:"!bg-warn"});return}_(!0),m("avatar",n.currentTarget.files[0])}},accept:"image/png, image/jpeg"}),s.jsx(t,{variant:"secondary",size:"sm",className:"w-full h-[40px] !text-[16px]",onClick:()=>{g.current&&g.current.click()},children:a("Upload avatar")})]})]})]})}),s.jsx(me,{}),s.jsx("div",{className:"above-769:hidden w-full",children:f?s.jsxs("div",{className:"flex w-full gap-4",children:[s.jsxs(t,{onClick:()=>l(!1),variant:"secondary",className:"w-full !text-base flex items-center justify-center",children:[s.jsx(M,{className:"rotate-45 size-6 mr-4 translate-y-[2px]"}),a("No")]}),s.jsxs(t,{onClick:U,variant:"secondary",className:"w-full !text-base !text-teal600 flex items-center !shadow-teal600 justify-center",children:[s.jsx(J,{className:"mr-4 size-5 translate-y-[1px]"}),a("Yes")]})]}):s.jsx(t,{onClick:()=>l(!0),variant:"secondary",className:"!shadow-teal600 !text-teal600 !bg-transparent !text-base w-full",children:a("Delete account")})})]})]})]})},Ne=ce(de);export{Ne as default};
